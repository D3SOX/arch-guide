<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Encryption | Arch Linux Guide</title>
    <meta name="description" content="My installation instructions and guide for Arch Linux">
    <link rel="preload stylesheet" href="/assets/style.d631cb70.css" as="style">
    <script type="module" src="/assets/app.d51d9c87.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/assets/chunks/framework.5dd80646.js">
  <link rel="modulepreload" href="/assets/chunks/theme.45f474dc.js">
  <link rel="modulepreload" href="/assets/encryption_index.md.16bbf796.lean.js">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <script defer="" data-domain="arch.d3sox.me" src="https://analytics.soundux.rocks/js/script.js"></script>
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b2cf3e0b><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8616af1></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8616af1> Skip to content </a><!--]--><!----><header class="VPNav" data-v-b2cf3e0b data-v-7e5bc4a5><div class="VPNavBar" data-v-7e5bc4a5 data-v-94c81dcc><div class="container" data-v-94c81dcc><div class="title" data-v-94c81dcc><div class="VPNavBarTitle" data-v-94c81dcc data-v-f4ef19a3><a class="title" href="/" data-v-f4ef19a3><!--[--><!--]--><!----><!--[-->Arch Linux Guide<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-94c81dcc><div class="curtain" data-v-94c81dcc></div><div class="content-body" data-v-94c81dcc><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-94c81dcc><!--[--><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-94c81dcc data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/installation/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->Installation<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/encryption/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->Encryption<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/post-installation/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->Post-Installation<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tweaks/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->Fixes &amp; Tweaks<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/gaming/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->Gaming<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-94c81dcc data-v-f6a63727><label title="toggle dark mode" data-v-f6a63727 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-94c81dcc data-v-0394ad82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/D3SOX/arch-guide" aria-label="github" target="_blank" rel="noopener" data-v-f6988cfb data-v-c530cc0a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-94c81dcc data-v-40855f84 data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-764effdf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-764effdf><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><label title="toggle dark mode" data-v-40855f84 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/D3SOX/arch-guide" aria-label="github" target="_blank" rel="noopener" data-v-f6988cfb data-v-c530cc0a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-94c81dcc data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><!----><!----><div class="VPContent" id="VPContent" data-v-b2cf3e0b data-v-a494bd1d><div class="VPDoc has-aside" data-v-a494bd1d data-v-c4b0d3cf><!--[--><!--]--><div class="container" data-v-c4b0d3cf><div class="aside" data-v-c4b0d3cf><div class="aside-curtain" data-v-c4b0d3cf></div><div class="aside-container" data-v-c4b0d3cf><div class="aside-content" data-v-c4b0d3cf><div class="VPDocAside" data-v-c4b0d3cf data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-3f215769 data-v-ff0f39c8><div class="content" data-v-ff0f39c8><div class="outline-marker" data-v-ff0f39c8></div><div class="outline-title" data-v-ff0f39c8>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-ff0f39c8><span class="visually-hidden" id="doc-outline-aria-label" data-v-ff0f39c8> Table of Contents for current page </span><ul class="root" data-v-ff0f39c8 data-v-8f12e865><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c4b0d3cf><div class="content-container" data-v-c4b0d3cf><!--[--><!--]--><!----><main class="main" data-v-c4b0d3cf><div style="position:relative;" class="vp-doc _encryption_index" data-v-c4b0d3cf><div><h1 id="encryption" tabindex="-1">Encryption <a class="header-anchor" href="#encryption" aria-label="Permalink to &quot;Encryption&quot;">​</a></h1><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>This guide will mostly care for UEFI systems. Steps shouldn&#39;t be much different for non-UEFI systems. Have a look at the Arch wiki regarding <a href="https://wiki.archlinux.org/index.php/Dm-crypt" target="_blank" rel="noreferrer">system encryption</a> for more information.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>This guide uses X, Y and Z as placeholders. Adjust them accordingly to your setup. Additionally, &quot;sd&quot; could be different depending on the used connection method of your drive.</p></div><p>In this guide, the encryption configuration we want to achieve is this:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">|----------|----------------------|</span></span>
<span class="line"><span style="color:#A6ACCD;">                |   Swap   |   Other partitions   |</span></span>
<span class="line"><span style="color:#A6ACCD;">                |          |   e.g. / or /home    |</span></span>
<span class="line"><span style="color:#A6ACCD;">|---------------|---------------------------------|</span></span>
<span class="line"><span style="color:#A6ACCD;">|   Grub boot   |   Encrypted container (LUKS)    |</span></span>
<span class="line"><span style="color:#A6ACCD;">|---------------|---------------------------------|</span></span></code></pre></div><p>At first, we have a <code>/boot</code> partition that contains the Grub bootloader as well as the necessary files for UEFI. Then we have an encrypted container that uses LUKS that contains the swap and other partitions, like the root partition or <code>/home</code>. All your data as well as the system will be encrypted as a result of that.</p><p>This results in you having to type in a password directly after booting, which will unlock the encrypted LUKS container and then boot the system normally.</p><h2 id="partitioning" tabindex="-1">Partitioning <a class="header-anchor" href="#partitioning" aria-label="Permalink to &quot;Partitioning&quot;">​</a></h2><p>To get a brief overview of the disks, use the command</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">fdisk</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-l</span></span></code></pre></div><p>After you got the disk to use, run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">gdisk</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/sdX</span></span></code></pre></div><p>to partition the disk accordingly. For more information on how to use gdisk, see the <a href="https://wiki.archlinux.org/index.php/GPT_fdisk" target="_blank" rel="noreferrer">Arch wiki</a>. For completeness, the most used commands are:</p><table><thead><tr><th>Command</th><th>What does this do?</th></tr></thead><tbody><tr><td><code>o</code></td><td>New partition table</td></tr><tr><td><code>n</code></td><td>Create new partition</td></tr><tr><td><code>w</code></td><td>Write table to disk</td></tr></tbody></table><p>After partitioning, you want to have a layout that looks like this:</p><table><thead><tr><th>Partition</th><th>Usage</th><th>Size</th><th>Partition code</th><th>Partition type</th></tr></thead><tbody><tr><td><code>/dev/sdXY</code></td><td>Grub boot</td><td>Depends, <a href="/installation/partitioning-formatting.html#efi-system">300M are recommended</a></td><td><code>ef00</code></td><td>EFI System</td></tr><tr><td><code>/dev/sdXZ</code></td><td>LUKS container</td><td>Remaining</td><td><code>8E00</code></td><td>Linux Filesystem</td></tr></tbody></table><h2 id="the-crypt-container" tabindex="-1">The crypt container <a class="header-anchor" href="#the-crypt-container" aria-label="Permalink to &quot;The crypt container&quot;">​</a></h2><h3 id="create-crypt-container" tabindex="-1">Create crypt container <a class="header-anchor" href="#create-crypt-container" aria-label="Permalink to &quot;Create crypt container&quot;">​</a></h3><p>Now we create a crypt container on <code>sdXZ</code> using LUKS. For more information, see these two pages on the Arch wiki regarding dm-crypt:</p><ul><li><a href="https://wiki.archlinux.org/index.php/Dm-crypt/Encrypting_an_entire_system#LVM_on_LUKS" target="_blank" rel="noreferrer">Encrypting an entire system: LVM on LUKS</a></li><li><a href="https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption#Encryption_options_for_LUKS_mode" target="_blank" rel="noreferrer">Device encryption: Encryption options for LUKS mode</a></li></ul><p>Encrypt <code>dev/sdXZ</code>. You will be prompted for a password. <strong>Care for different keyboard layouts when typing in the password!</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cryptsetup</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">luksFormat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">aes-xts-plain64</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">512</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/sdXZ</span></span></code></pre></div><p>Now open the encrypted container and map it to the device <code>cryptroot</code>. You will be prompted for the encryption password.</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cryptsetup</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">open</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/sdXZ</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cryptroot</span></span></code></pre></div><h3 id="creating-lvm-within-the-luks-container" tabindex="-1">Creating LVM within the LUKS container <a class="header-anchor" href="#creating-lvm-within-the-luks-container" aria-label="Permalink to &quot;Creating LVM within the LUKS container&quot;">​</a></h3><p>We currently have an (open and) encrypted container, but no LVM inside. To do this, we first have to create a volume group. We will call it <code>main</code>:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vgcreate</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">main</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/mapper/cryptroot</span></span></code></pre></div><p>Now we create the partitions we need. Since we just want a swap partition and a root partition, we need these two commands. If you want additional partitions, e.g. for a separate home partition, adjust the following commands (in the other sections, too) according to your needs. For recommendations regarding the swap size, see the <a href="/installation/partitioning-formatting.html#swap">partitioning section of this guide</a>.</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">lvcreate</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">32G</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">main</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-n</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">swap</span></span>
<span class="line"><span style="color:#FFCB6B;">lvcreate</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-l</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#C3E88D;">%FREE</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">main</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-n</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root</span></span></code></pre></div><h3 id="create-the-filesystems" tabindex="-1">Create the filesystems <a class="header-anchor" href="#create-the-filesystems" aria-label="Permalink to &quot;Create the filesystems&quot;">​</a></h3><p>Now we format the newly created volumes and partitions. The UEFI partition needs to be of type <code>fat32</code>. Additionally, this will get you a <code>ext4</code> root partition. You can adjust this freely if you like.</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkfs.fat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-F</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">32</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/sdXY</span></span>
<span class="line"><span style="color:#FFCB6B;">mkswap</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/mapper/main-swap</span></span>
<span class="line"><span style="color:#FFCB6B;">mkfs.ext4</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/mapper/main-root</span></span></code></pre></div><h3 id="mounting-the-system" tabindex="-1">Mounting the system <a class="header-anchor" href="#mounting-the-system" aria-label="Permalink to &quot;Mounting the system&quot;">​</a></h3><p>Mount the system</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mount</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/mapper/main-root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/mnt</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/mnt/boot</span></span>
<span class="line"><span style="color:#FFCB6B;">mount</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/sdXY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/mnt/boot</span></span></code></pre></div><p>Additionally, enable the swap</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">swapon</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/mapper/main-swap</span></span></code></pre></div><p>When following the guide for a normal installation, you can go back to the <a href="/installation/base-installation.html">base installation page</a> now.</p><h2 id="adjust-linux-kernel-hooks" tabindex="-1">Adjust linux kernel hooks <a class="header-anchor" href="#adjust-linux-kernel-hooks" aria-label="Permalink to &quot;Adjust linux kernel hooks&quot;">​</a></h2><p>Edit the file <code>/etc/mkinitcpio.conf</code> to contain the following line</p><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">HOOKS</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">(base udev autodetect modconf block filesystems keyboard keymap encrypt lvm2 fsck)</span></span></code></pre></div><p>After that, run the command to create the initial ramdisk environment</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkinitcpio</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-P</span></span></code></pre></div><h2 id="install-grub" tabindex="-1">Install grub <a class="header-anchor" href="#install-grub" aria-label="Permalink to &quot;Install grub&quot;">​</a></h2><p>Before installing grub, we have to mount the efi variables and install important packages</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mount</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">efivarfs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">efivarfs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/sys/firmware/efi/efivars</span></span>
<span class="line"><span style="color:#FFCB6B;">pacman</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-S</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">grub</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">efibootmgr</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dosfstools</span></span></code></pre></div><p>Additionally, install the microcode packages for your cpu, e.g. <code>intel-ucode</code> or <code>amd-ucode</code>.</p><p>Now find the UUID of the root partition (in the line starting with <code>/dev/sdXZ</code>) and note it down</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">blkid</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UUID=</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p>Adjust <code>/etc/default/grub</code> because of the encryption. Replace <code>&lt;UUID&gt;</code> with the UUID of the device you found earlier.</p><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">GRUB_CMDLINE_LINUX</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cryptdevice=UUID=&lt;UUID&gt;:cryptroot root=/dev/mapper/main-root</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If you want to type the password with the keyboard layout of your home country, you can adjust the line like this with the languages of your choice. This example uses the german keyboard layout.</p><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">GRUB_CMDLINE_LINUX</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cryptdevice=UUID=&lt;UUID&gt;:cryptroot root=/dev/mapper/main-root lang=de locale=de_DE.UTF-8</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div></div><p>After that, you can install grub. Use the following commands to do that. <strong>Make sure no errors are reported here.</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">grub-install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--target=x86_64-efi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--efi-directory=/boot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--bootloader-id=arch_grub</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--recheck</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--debug</span></span>
<span class="line"><span style="color:#FFCB6B;">grub-mkconfig</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/boot/grub/grub.cfg</span></span></code></pre></div><p>When following the guide for a normal installation, you can go back to the <a href="/installation/configure-system.html">configure system page</a> now.</p><h2 id="additional-resources" tabindex="-1">Additional resources <a class="header-anchor" href="#additional-resources" aria-label="Permalink to &quot;Additional resources&quot;">​</a></h2><p>For more information, you can visit the following pages:</p><ul><li><a href="https://wiki.archlinux.org/index.php/Dm-crypt" target="_blank" rel="noreferrer">https://wiki.archlinux.org/index.php/Dm-crypt</a></li><li><a href="https://www.timoschindler.de/arch-linux-uefi-boot-mit-grub-und-verschluesseltem-lvm/" target="_blank" rel="noreferrer">https://www.timoschindler.de/arch-linux-uefi-boot-mit-grub-und-verschluesseltem-lvm/</a> (German)</li></ul><p>This guide tries to sum them all up in one neat page.</p></div></div></main><footer class="VPDocFooter" data-v-c4b0d3cf data-v-face870a><!--[--><!--]--><div class="edit-info" data-v-face870a><div class="edit-link" data-v-face870a><a class="VPLink link edit-link-button" href="https://github.com/D3SOX/arch-guide/edit/master/docs/encryption/index.md" target="_blank" rel="noreferrer" data-v-face870a data-v-8f4dc553><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-face870a><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> Edit this page<!--]--><!----></a></div><div class="last-updated" data-v-face870a><p class="VPLastUpdated" data-v-face870a data-v-7b3ebfe1>Last updated: <time datetime="2023-04-17T15:50:59.000Z" data-v-7b3ebfe1></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-b2cf3e0b data-v-2f86ebd2><div class="container" data-v-2f86ebd2><p class="message" data-v-2f86ebd2>Made by D3SOX with ❤️</p><!----></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"encryption_index.md\":\"16bbf796\",\"index.md\":\"29cdc48e\",\"gaming_index.md\":\"da0269dc\",\"installation_index.md\":\"a2794635\",\"installation_base-installation.md\":\"bc23a399\",\"installation_install-bootloader.md\":\"4905bd1f\",\"installation_configure-system.md\":\"cee48614\",\"installation_reboot.md\":\"fdd1ddb2\",\"installation_live-setup.md\":\"759ff273\",\"installation_mount-filesystems.md\":\"8456c42b\",\"installation_partitioning-formatting.md\":\"0fe46329\",\"installation_install-desktop.md\":\"f988af66\",\"installation_setup-users.md\":\"5be620a2\",\"installation_useful-packages.md\":\"d6fe22b3\",\"tweaks_index.md\":\"33889ad1\",\"post-installation_index.md\":\"2c7f7f68\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Arch Linux Guide\",\"description\":\"My installation instructions and guide for Arch Linux\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Installation\",\"link\":\"/installation/\"},{\"text\":\"Encryption\",\"link\":\"/encryption/\"},{\"text\":\"Post-Installation\",\"link\":\"/post-installation/\"},{\"text\":\"Fixes & Tweaks\",\"link\":\"/tweaks/\"},{\"text\":\"Gaming\",\"link\":\"/gaming/\"}],\"sidebar\":{\"/installation/\":[{\"text\":\"Installation\",\"items\":[{\"text\":\"Introduction\",\"link\":\"/installation/\"},{\"text\":\"Live Setup\",\"link\":\"/installation/live-setup\"},{\"text\":\"Partitioning & Formatting\",\"link\":\"/installation/partitioning-formatting\"},{\"text\":\"Mount file systems\",\"link\":\"/installation/mount-filesystems\"},{\"text\":\"Base installation\",\"link\":\"/installation/base-installation\"},{\"text\":\"Install Bootloader\",\"link\":\"/installation/install-bootloader\"},{\"text\":\"Configure system\",\"link\":\"/installation/configure-system\"},{\"text\":\"Setup users\",\"link\":\"/installation/setup-users\"},{\"text\":\"Install Desktop\",\"link\":\"/installation/install-desktop\"},{\"text\":\"Useful packages\",\"link\":\"/installation/useful-packages\"},{\"text\":\"Reboot\",\"link\":\"/installation/reboot\"}]}]},\"editLink\":{\"pattern\":\"https://github.com/D3SOX/arch-guide/edit/master/docs/:path\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/D3SOX/arch-guide\"}],\"footer\":{\"message\":\"Made by D3SOX with ❤️\"},\"algolia\":{\"appId\":\"0E44DZDX9K\",\"apiKey\":\"05f13b57950ef1918e20d7bb444ba444\",\"indexName\":\"arch-d3sox\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":true}")</script>
    
  </body>
</html>